# 4.1 NL 조인

조인의 기본은 NL 조인입니다.

NL 조인은 인덱스를 이용한 조인이기 때문에 튜닝 원리도 그대로 적용할 수 있습니다.



## 4.1.1 기본 매커니즘

사원 테이블, 고객 테이블이 있다고 가정합시다.

두 테이블에서 1996년 1월 1일 이후 입사한 사원이 관리하는 고객 데이터를 추출하는 프로그램을 작성한다고 가정합시다.

사원 테이블에는 사원번호가 있고, 고객 테이블에는 관리사원번호가 있습니다.



아래 SQL을 사용하면 원하는 결과를 쉽게 얻을 수 있습니다.

```sql
SELECT e.사원명, c.고객명, c.전화번호
FROM 사원 e, 고객 c
WHERE e.입사일자 >= '19960101'
AND c.관리사원번호 = e.사원번호
```



여기서 어떤 알고리즘을 사용하는 것이 좋을까요?

가장 쉽게 생각할 수 있는 방식은, 중첩 루프문을 사용하는 방법입니다.

사원테이블에서 1996년 1월 1일 이후 입사한 사원을 찾아 건건이 고객 테이블에서 사원번호가 일치하는 레코드를 찾는 것이고 이것이 바로 Nested Loop 조인의 알고리즘입니다.

일반적으로 NL 조인은 Outer와 Inner 양쪽 테이블 모두 인덱스를 이용합니다.

Outer 쪽 테이블은 사이즈가 크지 않으면 인덱스를 이용하지 않을 수 있습니다.

Table Full Scan을 하더라도 그것은 한 번에 그치기 때문입니다.

반면에 Inner 쪽 테이블은 인덱스를 사용해야 합니다. 

인덱스를 사용하지 않으면 Outer 테이블에서 읽은 모든 건에 대해서 Table Full Scan을 반복합니다.





## 4.1.2 NL 조인 실행계획 제어

NL 조인을 제어할 때는 use_nl 힌트를 사용합니다.

```sql
SELECT /*+ ordered use_nl(c) */ *
```



ordered 힌트는 FROM 절에 기술한 순서대로 조인하라고 옵티마이저에 지시할 때 사용합니다.



leading 힌트는 테이블의 조인 순서를 정해줄 수 있습니다.

```sql
SELECT /*+ leading(C, A, D, B) use_nl(A) use_nl(D) use_hash(B) */ *
FROM A, B, C, D
```

C와 A는 NL조인, 다시 D와 NL조인, 마지막으로 B와는 해쉬조인을 수행합니다.



## 4.1.3 NL 조인 수행 과정 분석



