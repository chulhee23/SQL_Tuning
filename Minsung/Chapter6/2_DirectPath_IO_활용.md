# 6.2 Direct Path I/O 활용

온라인 트랜잭션은 반복적으로 읽기 때문에 버퍼캐시가 성능 향상에 도움을 줍니다.

반면 정보계 시스템이나 배치 프로그램에서 사용하는 SQL은 주로 대량 데이터를 처리하기 때문에 버퍼캐시를 경유하는 I/O 메커니즘이 오히려 성능을 떨어뜨릴 수 있습니다.

그래서 오라클은 버퍼캐시를 경유하지 않고 곧바로 데이터 블록을 읽고 쓸 수 있는 Direct Path I/O 기능을 제공하는데, 지금부터 살펴봅시다.



## 6.2.1 Direct Path I/O

일반적인 블록 I/O는 DB 버퍼캐시를 경유합니다.

읽고자 하는 블록은 먼저 버퍼캐시에서 찾아보고, 찾지 못할 때만 디스크에서 읽습니다.

데이터를 변경할 때도 먼저 블록을 버퍼캐시에서 찾습니다.

찾은 버퍼블록에 변경을 가하고 나면, DBWR 프로세스가 변경된 블록(Dirty 블록)들을 주기적으로 찾아 데이터파일에 반영해줍니다.

대량 데이터를 읽고 쓸 때는 버퍼캐시에서 블록을 찾을 가능성이 거의 없기 때문에 성능이 오히려 저하됩니다.

그래서 오라클은 버퍼캐시를 경유하지 않고 곧바로 데이터 블록을 읽고 쓸 수 있는 Direct Path I/O 기능을 제공합니다.

아래는 그 기능이 작동하는 경우입니다.

1. 병렬 쿼리로 Full Scan을 수행할 때
2. 병렬 DML을 수행할 때
3. Direct Path Insert를 수행할 때
4. Temp 세그먼트 블록들을 읽고 쓸 때
5. direct 옵션을 지정하고 export를 수행할 때
6. nocache 옵션을 지정한 LOB 칼럼을 읽을 때



### 병렬 쿼리

쿼리문에 parallel, parallel_index 힌트를 사용하면 지정한 병렬도 만큼 병렬 프로세스가 떠서 동시에 작업을 진행합니다.

병렬도를 4로 지정하면 성능이 네 배 빨라지는 게 아니라 수십 배 빨라집니다.

이것이 바로 Direct Path I/O 때문에 나타나는 효과입니다.

버퍼캐시를 탐색하지 않고, 디스크로부터 버퍼캐시에 적재하는 부담도 없으니 빠른 것입니다.



## 6.2.2 Direct Path Insert

일반적인 INSERT가 느린 이유는 다음과 같습니다.

1. 데이터를 입력할 수 있는 블록을 FreeList에서 찾습니다. 테이블 HWM(High-Water-Mark) 아래쪽에 있는 블록 중 데이터 입력이 가능한 블록을 목록으로 관리하는 이를 FreeList라고 합니다.

